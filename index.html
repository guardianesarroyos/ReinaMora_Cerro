<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bariloche Cerros - Datos Meteorológicos</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --color-primario: #4a8fe7;
      --color-secundario: #ff9e00;
      --fondo-oscuro: #0f172a;
      --fondo-tarjeta: #1e293b;
      --texto-claro: #f8fafc;
      --texto-secundario: #94a3b8;
    }
    
    body {
      margin: 0;
      padding: 1rem;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--fondo-oscuro);
      color: var(--texto-claro);
      line-height: 1.5;
    }
    
    .contenedor {
      max-width: 600px;
      margin: 0 auto;
    }
    
    .encabezado {
      text-align: center;
      margin-bottom: 1.5rem;
      padding-bottom: 1rem;
      border-bottom: 1px solid #334155;
    }
    
    .encabezado h1 {
      color: var(--color-primario);
      margin-bottom: 0.5rem;
    }
    
    .encabezado h2 {
      color: var(--color-secundario);
      margin-top: 0;
      font-size: 1.2rem;
    }
    
    .tarjeta-estacion {
      background-color: var(--fondo-tarjeta);
      border-radius: 12px;
      padding: 1.5rem;
      margin-bottom: 1.5rem;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .nombre-estacion {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 1rem;
      color: var(--color-secundario);
      font-size: 1.2rem;
      font-weight: bold;
    }
    
    .datos-container {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
    }
    
    .dato-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem;
      background-color: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
    }
    
    .dato-icono {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
      color: var(--color-primario);
    }
    
    .dato-valor {
      font-size: 1.5rem;
      font-weight: bold;
      margin: 0.2rem 0;
    }
    
    .dato-etiqueta {
      font-size: 0.8rem;
      color: var(--texto-secundario);
      text-align: center;
    }
    
    .actualizacion {
      font-size: 0.8rem;
      text-align: right;
      color: var(--texto-secundario);
      margin-top: 1rem;
    }
    
    .footer {
      text-align: center;
      margin-top: 2rem;
      font-size: 0.8rem;
      color: var(--texto-secundario);
    }
    
    @media (max-width: 480px) {
      .datos-container {
        grid-template-columns: 1fr;
      }
      
      .dato-item {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
        text-align: left;
      }
      
      .dato-icono {
        margin-bottom: 0;
        margin-right: 1rem;
      }
      
      .dato-info {
        flex: 1;
      }
    }

    /* Estilos para errores */
    .error {
      color: #ff6b6b;
      font-size: 0.9rem;
    }
  </style>
</head>
<body>
  <div class="contenedor">
    <div class="encabezado">
      <h1><i class="fas fa-mountain"></i> Bari Cerros</h1>
      <h2>Monitoreo Meteorológico</h2>
    </div>
    
    <!-- Estación Lomas de Cauquen -->
    <div class="tarjeta-estacion">
      <div class="nombre-estacion">
        <i class="fas fa-cloud-sun"></i>
        <span>Reina Mora, Cerro (933 mts)</span>
      </div>
      
      <div class="datos-container">
        <div class="dato-item">
          <div class="dato-icono"><i class="fas fa-temperature-high"></i></div>
          <div class="dato-info">
            <div class="dato-valor" id="temp-principal">-- °C</div>
            <div class="dato-etiqueta">Temperatura</div>
          </div>
        </div>
        
        <div class="dato-item">
          <div class="dato-icono"><i class="fas fa-person-booth"></i></div>
          <div class="dato-info">
            <div class="dato-valor" id="st-principal">-- °C</div>
            <div class="dato-etiqueta">Sensación Térmica</div>
          </div>
        </div>
        
        <div class="dato-item">
          <div class="dato-icono"><i class="fas fa-wind"></i></div>
          <div class="dato-info">
            <div class="dato-valor" id="viento-principal">-- km/h</div>
            <div class="dato-etiqueta">Viento</div>
          </div>
        </div>
        
        <div class="dato-item">
          <div class="dato-icono"><i class="fas fa-cloud-rain"></i></div>
          <div class="dato-info">
            <div class="dato-valor" id="lluvia-principal">-- mm</div>
            <div class="dato-etiqueta">Lluvia 24h</div>
          </div>
        </div>
      </div>
      
      <div class="actualizacion" id="actualizacion-principal">Actualizando datos...</div>
    </div>
    
    <!-- Estación Villa Catedral (Cerro Catedral) -->
    <div class="tarjeta-estacion">
      <div class="nombre-estacion">
        <i class="fas fa-snowflake"></i>
        <span>Villa Catedral (1070 mts)</span>
      </div>
      
      <div class="datos-container">
        <div class="dato-item">
          <div class="dato-icono"><i class="fas fa-temperature-high"></i></div>
          <div class="dato-info">
            <div class="dato-valor" id="temp-secundaria">-- °C</div>
            <div class="dato-etiqueta">Temperatura</div>
          </div>
        </div>
        
        <div class="dato-item">
          <div class="dato-icono"><i class="fas fa-person-booth"></i></div>
          <div class="dato-info">
            <div class="dato-valor" id="st-secundaria">-- °C</div>
            <div class="dato-etiqueta">Sensación Térmica</div>
          </div>
        </div>
        
        <div class="dato-item">
          <div class="dato-icono"><i class="fas fa-wind"></i></div>
          <div class="dato-info">
            <div class="dato-valor" id="viento-secundaria">-- km/h</div>
            <div class="dato-etiqueta">Viento</div>
          </div>
        </div>
        
        <div class="dato-item">
          <div class="dato-icono"><i class="fas fa-cloud-rain"></i></div>
          <div class="dato-info">
            <div class="dato-valor" id="lluvia-secundaria">-- mm</div>
            <div class="dato-etiqueta">Lluvia/Nieve 24h</div>
          </div>
        </div>
      </div>
      
      <div class="actualizacion" id="actualizacion-secundaria">Actualizando datos...</div>
    </div>
    
    <div class="footer">
      <p>Actualización automática cada 5 minutos</p>
      <p>Datos proporcionados por Open-Meteo y OpenWeather</p>
    </div>
  </div>

  <script>
    // Configuración de estaciones (¡Actualiza las coordenadas!)
    const estaciones = {
      principal: {
        nombre: "Reina Mora, Cerro",
        lat: -41.185470,  // Cambia por tus coordenadas reales
        lon: -71.371370,
        altitud: "933 mts"
      },
      secundaria: {
        nombre: "Villa Catedral",
        lat: -41.1667,  // Coordenadas del Cerro Catedral
        lon: -71.4333,
        altitud: "1070 mts"
      }
    };

    // API Keys de OpenWeather (backup)
    const OPENWEATHER_KEYS = [
      "7cc8d8cf7132492c8e5cff1c94a9bcd3df4359c7e0ac491e9f323747c08e5069",
      "ea76122029c94fb2834f9b8e848916107c325d4888044a0589e904b791aeecbb"
    ];

    // --- Funciones principales ---
    async function obtenerDatosOpenMeteo(lat, lon) {
      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,apparent_temperature,rain,wind_speed_10m,relative_humidity_2m&timezone=auto`;
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error("Error en respuesta");
        const data = await response.json();
        return {
          temperatura: data.current.temperature_2m,
          sensacionTermica: data.current.apparent_temperature,
          viento: (data.current.wind_speed_10m * 3.6).toFixed(1), // m/s → km/h
          lluvia: data.current.rain || "0.0",
          actualizacion: new Date().toISOString(),
          fuente: "Open-Meteo"
        };
      } catch (error) {
        console.error("Open-Meteo falló:", error);
        return null;
      }
    }

    async function obtenerDatosOpenWeather(lat, lon, apiKey) {
      const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&units=metric&appid=${apiKey}`;
      try {
        const response = await fetch(url);
        if (!response.ok) throw new Error("API key puede ser inválida");
        const data = await response.json();
        return {
          temperatura: data.main.temp,
          sensacionTermica: data.main.feels_like,
          viento: (data.wind.speed * 3.6).toFixed(1), // m/s → km/h
          lluvia: data.rain?.["1h"] || "0.0",
          actualizacion: new Date().toISOString(),
          fuente: `OpenWeather (key ${apiKey.slice(0, 5)}...)`
        };
      } catch (error) {
        console.error(`OpenWeather falló con key ${apiKey.slice(0, 5)}:`, error);
        return null;
      }
    }

    // Intenta con todas las fuentes hasta obtener datos
    async function obtenerDatosConFallback(lat, lon) {
      // 1. Intentar con Open-Meteo primero
      let datos = await obtenerDatosOpenMeteo(lat, lon);
      if (datos) return datos;

      // 2. Si falla, probar con cada API key de OpenWeather
      for (const key of OPENWEATHER_KEYS) {
        datos = await obtenerDatosOpenWeather(lat, lon, key);
        if (datos) return datos;
      }

      // 3. Si todo falla
      return null;
    }

    // Actualizar la interfaz
    function actualizarInterfazEstacion(datos, prefijo) {
      const contenedor = document.getElementById(`actualizacion-${prefijo}`);
      
      if (!datos) {
        contenedor.textContent = "Error: No se pudieron cargar datos";
        contenedor.classList.add("error");
        return;
      }

      // Actualizar valores
      document.getElementById(`temp-${prefijo}`).textContent = `${datos.temperatura} °C`;
      document.getElementById(`st-${prefijo}`).textContent = `${datos.sensacionTermica} °C`;
      document.getElementById(`viento-${prefijo}`).textContent = `${datos.viento} km/h`;
      document.getElementById(`lluvia-${prefijo}`).textContent = `${datos.lluvia} mm`;

      // Mostrar fuente y hora
      const hora = new Date(datos.actualizacion).toLocaleTimeString("es-AR");
      contenedor.textContent = `Actualizado: ${hora} (Fuente: ${datos.fuente})`;
      contenedor.classList.remove("error");
    }

    // Actualizar todas las estaciones
    async function actualizarTodasEstaciones() {
      for (const [prefijo, estacion] of Object.entries(estaciones)) {
        const datos = await obtenerDatosConFallback(estacion.lat, estacion.lon);
        actualizarInterfazEstacion(datos, prefijo);
      }
    }

    // Inicialización
    document.addEventListener("DOMContentLoaded", () => {
      actualizarTodasEstaciones();
      setInterval(actualizarTodasEstaciones, 5 * 60 * 1000); // Actualizar cada 5 minutos
    });
  </script>
</body>
</html>